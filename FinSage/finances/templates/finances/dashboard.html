<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - FinSage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        :root {
            --primary-color: #0f766e;
            --primary-dark: #134e4a;
            --secondary-color: #0d9488;
            --accent-color: #2dd4bf;
            --text-color: #1e293b;
            --light-bg: #f8fafc;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
        }

        .header {
            background-color: var(--primary-color);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-container img {
            height: 50px;
        }

        .brand-name {
            color: var(--white);
            font-size: 1.8em;
            font-weight: bold;
        }

        .dropdown-menu {
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        .nav-link {
            color: var(--white) !important;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h4 {
            color: var(--text-color);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .stat-card .amount {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .section-title {
            color: var(--primary-dark);
            margin-bottom: 1.5rem;
            font-weight: 600;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--accent-color);
            border-radius: 3px;
        }

        .search-container {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        .search-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .search-group label {
            font-weight: 500;
            color: var(--primary-dark);
        }

        .search-input {
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
        }

        .expense-group {
            margin-bottom: 1.5rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            background: var(--white);
        }

        .month-year-header {
            background-color: var(--primary-dark);
            color: var(--white);
            padding: 0.75rem 1rem;
            border-radius: 8px 8px 0 0;
            margin-bottom: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .month-year-header .toggle-btn {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
        }

        .month-total {
            font-weight: 500;
            padding: 0.5rem 1rem;
            background-color: var(--light-bg);
            border-top: 1px solid #e2e8f0;
        }

        .table {
            margin-bottom: 0;
        }

        .table thead {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .table th {
            font-weight: 500;
            padding: 1rem;
        }

        .table td {
            padding: 1rem;
            vertical-align: middle;
        }

        .btn-custom {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .btn-warning {
            background-color: #fbbf24;
            border: none;
        }

        .btn-danger {
            background-color: #ef4444;
            border: none;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid var(--primary-color);
            background: var(--white);
            color: var(--primary-color);
            border-radius: 6px;
            cursor: pointer;
        }

        .pagination button.active {
            background: var(--primary-color);
            color: var(--white);
        }

        .messages {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .messages.success {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }

        .messages.error {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .search-form {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 1rem;
            }
            
            .brand-name {
                font-size: 1.4em;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <img src="data:image/png;base64,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"alt="FinSage Logo" style="height: 50px; margin-right: 10px;">
            <span class="brand-name">FinSage</span>
        </div>
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <div class="collapse navbar-collapse">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                More
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="{% url 'finances:upload_bill' %}">Upload Bill</a></li>
                                <li><a class="dropdown-item" href="{% url 'finances:export_expenses' %}">Export Expenses</a></li>
                                <li><a class="dropdown-item" href="{% url 'finances:add_income' %}">Add Income</a></li>
                                <li><a class="dropdown-item" href="{% url 'finances:add_expense' %}">Add Expense</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="/logout">Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <h1 class="section-title">Dashboard</h1>

        {% if messages %}
            {% for message in messages %}
                {% if forloop.last %}
                    <div class="messages {{ message.tags }}">
                        {{ message }}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}

        <div class="stats-cards">
            <div class="stat-card">
                <h4>Total Income</h4>
                <div class="amount">₹{{ total_income }}</div>
            </div>
            <div class="stat-card">
                <h4>Total Expenses</h4>
                <div class="amount">₹{{ total_expenses }}</div>
            </div>
            <div class="stat-card">
                <h4>Balance</h4>
                <div class="amount">₹{{ balance }}</div>
            </div>
        </div>

        <h3 class="section-title">Income Entries</h3>
        <div class="table-responsive">
            <table class="table table-striped">
            <!-- <table class="table"> -->
                <thead >
                    <tr>
                        <th>Amount</th>
                        <th>Description</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if incomes %}
                        {% for income in incomes %}
                            <tr>
                                <td>₹{{ income.amount }}</td>
                                <td>{{ income.description }}</td>
                                <td>{{ income.date }}</td>
                                <td>
                                    <a href="{% url 'finances:edit_income' income.id %}" class="btn btn-warning btn-custom">Edit</a>
                                    <a href="{% url 'finances:delete_income' income.id %}" class="btn btn-danger btn-custom" onclick="return confirm('Are you sure you want to delete this income?')">Delete</a>
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="text-center">No income entries found.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <h3 class="section-title mt-4">Expense Management</h3>

        <div class="search-container p-3">
            <form method="GET" action="" class="row g-2">
                <div class="col-md-4">
                    <label for="month" class="form-label">Month</label>
                    <select name="month" id="month" class="form-select">
                            <option value="">Default</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        {% for i in "123456789101112"|make_list %}
                            <option value="{{ i }}" {% if request.GET.month == i|stringformat:"s" %}selected{% endif %}>
                                {{ i|date:"F" }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
        
                <div class="col-md-4">
                    <label for="year" class="form-label">Year</label>
                    <select name="year" id="year" class="form-select">
                        <option value="">All Years</option>
                        {% for year in available_years %}
                            <option value="{{ year }}" {% if request.GET.year == year|stringformat:"s" %}selected{% endif %}>
                                {{ year }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-4">
                    <label for="date" class="form-label">Date</label>
                    <input type="date" name="date" class="form-control" placeholder="Search by date" value="{{ request.GET.date|default:'' }}">
                </div>
        
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-search"></i> Search</button>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <a href="{% url 'finances:dashboard' %}" class="btn btn-secondary w-100">
                        <i class="fas fa-sync-alt"></i> Reset
                    </a>
                </div>
            </form>
        </div>
    
                <!-- <div class="search-group">
                    <label for="category">Category</label>
                    <select name="category" id="category" class="search-input">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>  -->

        {% regroup expenses by month_year as expense_list %}
        
        {% for month_expenses in expense_list %}
        <div class="expense-group">
            <div class="month-year-header">
                <h4 class="mb-0"></h4>
                <button class="toggle-btn" onclick="toggleExpenses('expense-{{ forloop.counter }}')">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div id="expense-{{ forloop.counter }}" class="collapse show">
                <div class="table-responsive">
                    <table class="table mb-0">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Amount </th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense in month_expenses.list %}
                            <tr>
                                <td>{{ expense.date|date:"d M Y" }}</td>
                                <td>₹{{ expense.amount }}</td>
                                <td>{{ expense.description }}</td>
                                <td>{{ expense.category.name }}</td>
                                <td>
                                    <a href="{% url 'finances:edit_expense' expense.id %}" class="btn btn-warning btn-custom">Edit</a>
                                    <a href="{% url 'finances:delete_expense' expense.id %}" class="btn btn-danger btn-custom" onclick="return confirm('Are you sure?')">Delete</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <!-- <div class="month-total">
                        Total for {{ month_expenses.grouper }}: ₹{{ month_expenses.total }}
                    </div> -->
                </div>
            </div>
        </div>
        {% empty %}
        <div class="expense-group">
            <div class="table-responsive">
                <table class="table mb-0">
                    <tbody>
                        <tr>
                            <td colspan="5" class="text-center">No expense entries found.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}

        <div class="pagination">
            {% if expenses.has_previous %}
                <button onclick="location.href='?page={{ expenses.previous_page_number }}&month={{ request.GET.month }}&year={{ request.GET.year }}&category={{ request.GET.category }}'">Previous</button>
            {% endif %}
            
            <button class="active">{{ expenses.number }}</button>
            
            {% if expenses.has_next %}
                <button onclick="location.href='?page={{ expenses.next_page_number }}&month={{ request.GET.month }}&year={{ request.GET.year }}&category={{ request.GET.category }}'">Next</button>
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
    const urlParams = new URLSearchParams(window.location.search);

    // Scroll to search section if filters were used
    if (urlParams.has('month') || urlParams.has('year') || urlParams.has('date')) {
        setTimeout(() => {
            const searchSection = document.getElementById("search-section");
            if (searchSection) {
                searchSection.scrollIntoView({ behavior: "smooth" });
            }
        }, 300); // Small delay ensures smooth scrolling
    }

    // Set the selected values in filters
    const monthSelect = document.getElementById('month');
    const yearSelect = document.getElementById('year');

    if (monthSelect && urlParams.has('month')) {
        monthSelect.value = urlParams.get('month');
    }

    if (yearSelect && urlParams.has('year')) {
        yearSelect.value = urlParams.get('year');
    }
});

// Function to toggle expense sections
function toggleExpenses(id) {
    const element = document.getElementById(id);
    if (!element) return;

    const button = element.previousElementSibling.querySelector('.toggle-btn i');
    
    if (element.classList.contains('show')) {
        element.classList.remove('show');
        button.classList.replace('fa-chevron-down', 'fa-chevron-right');
    } else {
        element.classList.add('show');
        button.classList.replace('fa-chevron-right', 'fa-chevron-down');
    }
}

    </script>
</body>
</html>